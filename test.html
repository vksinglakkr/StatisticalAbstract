<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Ultra Simple Autocomplete Test</title>
  <style>
    * { box-sizing: border-box; }
    body { 
      font-family: Arial; 
      padding: 20px; 
      max-width: 800px; 
      margin: 0 auto;
    }
    h2 { color: #2563eb; }
    .status { 
      padding: 15px; 
      background: #dbeafe; 
      border-radius: 8px;
      margin: 20px 0;
      font-weight: bold;
    }
    .status.success { background: #d1fae5; color: #065f46; }
    .status.error { background: #fee2e2; color: #991b1b; }
    
    #userInput { 
      width: 100%; 
      padding: 12px; 
      font-size: 16px; 
      border: 2px solid #ddd;
      border-radius: 8px;
      margin: 10px 0;
    }
    #userInput:focus {
      outline: none;
      border-color: #2563eb;
    }
    
    #dropdown { 
      border: 2px solid #2563eb; 
      border-radius: 8px;
      max-height: 300px; 
      overflow-y: auto; 
      display: none;
      background: white;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .item { 
      padding: 12px; 
      cursor: pointer; 
      border-bottom: 1px solid #e5e7eb;
    }
    .item:hover { 
      background: #eff6ff; 
    }
    .item:last-child {
      border-bottom: none;
    }
    .item small {
      color: #6b7280;
      font-size: 12px;
    }
    
    .info { 
      margin: 20px 0;
      padding: 15px;
      background: #fef3c7;
      border-radius: 8px;
      border-left: 4px solid #f59e0b;
    }
  </style>
</head>
<body>
  <h2>üß™ Ultra Simple Autocomplete Test</h2>
  
  <div class="status" id="status">‚è≥ Loading Google Sheets...</div>
  
  <div class="info">
    <strong>How to test:</strong>
    <ol style="margin: 10px 0;">
      <li>Wait for "Loaded X questions" message above</li>
      <li>Type in the box below (at least 2 characters)</li>
      <li>Watch for autocomplete dropdown to appear</li>
    </ol>
  </div>
  
  <label style="display: block; margin-bottom: 8px; font-weight: bold;">
    Type to search (e.g., "har", "agr", "pop"):
  </label>
  <input 
    type="text" 
    id="userInput" 
    placeholder="Start typing at least 2 characters..."
    disabled
  >
  <div id="dropdown"></div>
  
  <div style="margin-top: 30px; padding: 15px; background: #f3f4f6; border-radius: 8px;">
    <strong>Console Log:</strong>
    <div id="log" style="font-family: monospace; font-size: 12px; margin-top: 10px;"></div>
  </div>

  <script>
    const GOOGLE_SHEET_URL = 'https://docs.google.com/spreadsheets/d/17mpGz4-lw-xBYqDiHj7RV1z0w_5k8lEmSmVqsxS36ro/export?format=tsv&gid=740242886';
    
    let masterFileData = [];
    const statusEl = document.getElementById('status');
    const userInput = document.getElementById('userInput');
    const dropdown = document.getElementById('dropdown');
    const logEl = document.getElementById('log');
    
    function log(message) {
      console.log(message);
      logEl.innerHTML += message + '<br>';
    }
    
    // Load Google Sheets
    async function loadData() {
      try {
        log('üì° Fetching Google Sheets...');
        statusEl.textContent = 'üì° Fetching from Google Sheets...';
        
        const response = await fetch(GOOGLE_SHEET_URL);
        log(`üì• Response status: ${response.status}`);
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }
        
        const tsvText = await response.text();
        log(`üìÑ Received ${tsvText.length} characters`);
        
        const lines = tsvText.split('\n');
        log(`üìä Parsing ${lines.length} lines...`);
        
        // Skip header (line 0)
        for (let i = 1; i < lines.length; i++) {
          const line = lines[i].trim();
          if (!line) continue;
          
          const columns = line.split('\t');
          if (columns.length >= 3) {
            const question = columns[0].trim();
            const sec_code = columns[1].trim();
            const chp_code = columns[2].trim();
            
            if (question && sec_code && chp_code) {
              masterFileData.push({
                chapter_name: question,
                sec_code: sec_code,
                chp_code: chp_code,
                search_text: question.toLowerCase()
              });
            }
          }
        }
        
        log(`‚úÖ SUCCESS! Loaded ${masterFileData.length} questions`);
        statusEl.className = 'status success';
        statusEl.innerHTML = `‚úÖ <strong>Loaded ${masterFileData.length} questions!</strong> You can now type in the box below.`;
        
        // Enable input
        userInput.disabled = false;
        userInput.focus();
        
        log('Sample data:');
        log(JSON.stringify(masterFileData.slice(0, 3), null, 2));
        
      } catch (error) {
        log(`‚ùå ERROR: ${error.message}`);
        statusEl.className = 'status error';
        statusEl.innerHTML = `‚ùå <strong>Error loading data:</strong> ${error.message}`;
      }
    }
    
    // Autocomplete
    userInput.addEventListener('input', function() {
      const query = this.value.trim().toLowerCase();
      
      log(`üîç Searching for: "${query}"`);
      
      if (query.length < 2) {
        dropdown.style.display = 'none';
        log('‚ö†Ô∏è Query too short (need 2+ chars)');
        return;
      }
      
      // Search
      const results = masterFileData.filter(item => 
        item.search_text.includes(query)
      ).slice(0, 15);
      
      log(`üìä Found ${results.length} matches`);
      
      if (results.length > 0) {
        let html = '';
        results.forEach(item => {
          html += `
            <div class="item">
              <div style="font-weight: 500;">${item.chapter_name}</div>
              <small>${item.sec_code} | Chapter ${item.chp_code}</small>
            </div>
          `;
        });
        dropdown.innerHTML = html;
        dropdown.style.display = 'block';
        log('‚úÖ Dropdown displayed');
      } else {
        dropdown.innerHTML = '<div class="item">‚ùå No results found</div>';
        dropdown.style.display = 'block';
        log('‚ö†Ô∏è No matches found');
      }
    });
    
    // Click outside to close
    document.addEventListener('click', function(e) {
      if (!userInput.contains(e.target) && !dropdown.contains(e.target)) {
        dropdown.style.display = 'none';
      }
    });
    
    // Start loading
    log('üöÄ Starting...');
    loadData();
  </script>
</body>
</html>
