<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>STATS SAHAYAK ‚Äì Statistical Abstract Chatbot</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800;900&family=Playfair+Display:wght@700;900&family=Noto+Sans+Devanagari:wght@400;500;600;700&display=swap" rel="stylesheet">
 <style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: radial-gradient(ellipse at top, #1e3a8a, #0f172a);
    font-family: 'Poppins', sans-serif;
    min-height: 100vh;
    position: relative;
    overflow-x: hidden;
  }
  body::before {
    content: '';
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background-image: 
      radial-gradient(circle at 20% 50%, rgba(251, 191, 36, 0.1) 0%, transparent 50%),
      radial-gradient(circle at 80% 80%, rgba(249, 115, 22, 0.1) 0%, transparent 50%);
    pointer-events: none;
    z-index: 0;
  }
  .devanagari { font-family: 'Noto Sans Devanagari', sans-serif; }
  .playfair { font-family: 'Playfair Display', serif; }
  .container-main { position: relative; z-index: 1; }
  .glass-card {
    background: rgba(255, 255, 255, 0.98);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.1) inset;
  }
  .gradient-text {
    background: linear-gradient(135deg, #ff6b35 0%, #f59e0b 50%, #ff6b35 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    background-size: 200% auto;
    animation: shimmer 3s linear infinite;
  }
  .mic-btn {
    transition: all 0.3s;
    -webkit-tap-highlight-color: transparent;
  }
  .mic-btn.recording {
    background: linear-gradient(135deg, #dc2626, #ef4444) !important;
    border-color: #dc2626 !important;
    animation: pulseRec 1.5s ease-in-out infinite;
  }
  @keyframes pulseRec {
    0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7); }
    50% { transform: scale(1.1); box-shadow: 0 0 0 10px rgba(220, 38, 38, 0); }
  }
  @keyframes shimmer { to { background-position: 200% center; } }
  .header-glow { position: relative; }
  .header-glow::before {
    content: '';
    position: absolute;
    top: -20px; left: 50%;
    transform: translateX(-50%);
    width: 200px; height: 200px;
    background: radial-gradient(circle, rgba(251, 191, 36, 0.3), transparent 70%);
    filter: blur(40px);
    pointer-events: none;
  }
  .tts-btn {
    padding: 8px 16px;
    border-radius: 12px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    border: none;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .tts-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
  .tts-btn.speaking { animation: pulse 1.5s ease-in-out infinite; }
  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.8; transform: scale(1.05); }
  }
  .lang-toggle {
    display: inline-flex;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 12px;
    padding: 4px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  .lang-toggle button {
    padding: 8px 20px;
    border-radius: 10px;
    transition: all 0.3s;
    font-size: 14px;
    font-weight: 600;
    border: none;
    background: transparent;
    color: #64748b;
  }
  .lang-toggle button.active {
    background: linear-gradient(135deg, #1e40af, #3b82f6);
    color: white;
    box-shadow: 0 4px 12px rgba(30, 64, 175, 0.4);
    transform: scale(1.05);
  }
  
.query-type-selector {
  background: linear-gradient(135deg, #fef3c7, #fed7aa);
  border: 3px solid #f59e0b;
  border-radius: 20px;
  padding: 20px 16px;
  margin-bottom: 24px;
  box-shadow: 0 8px 24px rgba(245, 158, 11, 0.3);
}

.radio-option {
  position: relative;
  display: flex;
  align-items: flex-start;
  padding: 14px 16px;
  background: white;
  border: 3px solid #e5e7eb;
  border-radius: 16px;
  cursor: pointer;
  transition: all 0.3s;
  margin-bottom: 12px;
  min-height: 80px;
}

.radio-option:last-child {
  margin-bottom: 0;
}

.radio-option:hover {
  border-color: #f59e0b;
  transform: translateX(4px);
  box-shadow: 0 4px 16px rgba(245, 158, 11, 0.2);
}

.radio-option input[type="radio"] {
  width: 22px;
  height: 22px;
  min-width: 22px;
  margin-right: 12px;
  margin-top: 2px;
  cursor: pointer;
  accent-color: #f59e0b;
  flex-shrink: 0;
}

.radio-option.selected {
  border-color: #f59e0b;
  background: linear-gradient(135deg, #fffbeb, #fef3c7);
  box-shadow: 0 6px 20px rgba(245, 158, 11, 0.3);
  transform: scale(1.02);
}

.radio-icon {
  font-size: 28px;
  min-width: 36px;
  margin-right: 8px;
  flex-shrink: 0;
  line-height: 1;
  margin-top: 2px;
}

.radio-label {
  display: flex;
  flex-direction: column;
  flex: 1;
  min-width: 0;
  gap: 2px;
}

.radio-label-title {
  font-size: 16px;
  font-weight: 700;
  color: #1f2937;
  line-height: 1.3;
  word-wrap: break-word;
  overflow-wrap: break-word;
  hyphens: auto;
}

.radio-label-desc {
  font-size: 12px;
  color: #6b7280;
  line-height: 1.4;
  word-wrap: break-word;
  overflow-wrap: break-word;
}

/* AUTOCOMPLETE STYLES */
.autocomplete-container {
  position: relative;
  width: 100%;
}

.autocomplete-dropdown {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  background: white;
  border: 2px solid #f59e0b;
  border-top: none;
  border-radius: 0 0 16px 16px;
  max-height: 300px;
  overflow-y: auto;
  z-index: 1000;
  box-shadow: 0 8px 24px rgba(245, 158, 11, 0.3);
  margin-top: -8px;
}

.autocomplete-item {
  padding: 12px 16px;
  cursor: pointer;
  border-bottom: 1px solid #f3f4f6;
  transition: all 0.2s;
  font-size: 12px;
  line-height: 1.5;
}

.autocomplete-item:last-child {
  border-bottom: none;
}

.autocomplete-item:hover {
  background: linear-gradient(135deg, #fffbeb, #fef3c7);
  font-weight: 600;
}

.autocomplete-item mark {
  background: #fef3c7;
  color: #ea580c;
  font-weight: 700;
  padding: 2px 4px;
  border-radius: 4px;
}

.autocomplete-no-results {
  padding: 16px;
  text-align: center;
  color: #6b7280;
  font-size: 14px;
}

.autocomplete-category {
  padding: 8px 16px;
  font-size: 11px;
  font-weight: 700;
  color: #f59e0b;
  background: #fffbeb;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  border-bottom: 1px solid #fed7aa;
}

/* MODAL STYLES */
.modal {
  display: none;
  position: fixed;
  z-index: 9999;
  left: 0; top: 0;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  background-color: rgba(0, 0, 0, 0.95);
  animation: fadeIn 0.3s ease-in-out;
}

.modal.hidden { display: none !important; }

.modal-content {
  position: relative;
  background: linear-gradient(135deg, #ffffff, #fefce8);
  margin: 0;
  padding: 0;
  width: 100vw;
  height: 100vh;
  border-radius: 0;
  box-shadow: none;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.modal-header {
  background: linear-gradient(135deg, #1e40af, #3b82f6);
  color: white;
  padding: 16px 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  flex-shrink: 0;
}

.modal-body {
  flex: 1;
  overflow-y: auto;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.modal-footer {
  background: white;
  border-top: 2px solid #e5e7eb;
  padding: 16px 20px;
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
  justify-content: center;
  box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.05);
  flex-shrink: 0;
}

.close-btn {
  background: rgba(255, 255, 255, 0.2);
  border: 2px solid rgba(255, 255, 255, 0.5);
  color: white;
  font-size: 28px;
  font-weight: bold;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  cursor: pointer;
  transition: all 0.3s;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0;
  line-height: 1;
}

.close-btn:hover {
  background: rgba(255, 255, 255, 0.3);
  transform: rotate(90deg) scale(1.1);
}

.question-box, .answer-box {
  background: white;
  padding: 20px;
  border-radius: 16px;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
  border-left: 6px solid #f59e0b;
}

.question-box h3, .answer-box h3 {
  color: #1e40af;
  font-size: 18px;
  font-weight: 700;
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.question-text, .answer-text {
  color: #1f2937;
  font-size: 16px;
  line-height: 1.8;
  word-wrap: break-word;
  white-space: pre-wrap;
}

.answer-text {
  font-size: 15px;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@media (min-width: 768px) {
  .modal-content {
    margin: 2% auto;
    width: 95%;
    max-width: 900px;
    height: auto;
    max-height: 96vh;
    border-radius: 24px;
  }
}

/* Feedback Modal Styles */
.feedback-modal {
  display: none;
  position: fixed;
  z-index: 10000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0, 0, 0, 0.8);
  animation: fadeIn 0.3s ease-in-out;
}

.feedback-modal.show {
  display: flex;
  align-items: center;
  justify-content: center;
}

.feedback-modal-content {
  position: relative;
  background: white;
  margin: 20px;
  padding: 0;
  width: 95%;
  max-width: 600px;
  border-radius: 20px;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
  overflow: hidden;
}

.feedback-modal-header {
  background: linear-gradient(135deg, #1e40af, #3b82f6);
  color: white;
  padding: 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.feedback-modal-body {
  padding: 0;
  height: 70vh;
  max-height: 600px;
  position: relative;
}

.feedback-modal iframe {
  width: 100%;
  height: 100%;
  border: none;
}

.iframe-loader {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
  display: none;
}

.spinner {
  border: 4px solid #f3f4f6;
  border-top: 4px solid #f59e0b;
  border-radius: 50%;
  width: 50px;
  height: 50px;
  animation: spin 1s linear infinite;
  margin: 0 auto 16px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

</style>
</head>
<body>

<div class="container-main min-h-screen flex items-center justify-center p-4">
  <div class="w-full max-w-3xl">
    
    <!-- Header Section -->
    <div class="header-glow text-center mb-8">
      <h1 class="text-5xl md:text-6xl font-black mb-2 gradient-text playfair">
        STATS SAHAYAK
      </h1>
      <p class="text-xl md:text-2xl text-amber-300 font-semibold tracking-wide devanagari">
        Statistical Abstract Chatbot
      </p>
      <p class="text-sm text-blue-200 mt-2 font-medium">
        Department of Economic and Statistical Affairs, Haryana
      </p>
    </div>

    <!-- Main Card -->
    <div class="glass-card rounded-3xl shadow-2xl p-6 md:p-8">
      
      <!-- Language Toggle -->
      <div class="flex justify-center mb-6">
        <div class="lang-toggle">
          <button id="langEnglish" class="active" onclick="switchLanguage('english')">English</button>
          <button id="langHindi" onclick="switchLanguage('hindi')">‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
        </div>
      </div>

      <!-- Query Type Selection -->
      <div class="query-type-selector">
        <h3 class="text-center text-lg font-bold text-gray-800 mb-4">
          üìä Choose Your Query Type
        </h3>
        
        <label class="radio-option" id="radioOption1">
          <input type="radio" name="queryType" value="statistics" checked>
          <span class="radio-icon">üìö</span>
          <div class="radio-label">
            <span class="radio-label-title">Learn About Statistics</span>
            <span class="radio-label-desc">Get explanations about statistical terms and concepts</span>
          </div>
        </label>

        <label class="radio-option" id="radioOption2">
          <input type="radio" name="queryType" value="data">
          <span class="radio-icon">üìà</span>
          <div class="radio-label">
            <span class="radio-label-title">Find Haryana Data</span>
            <span class="radio-label-desc">Search for specific data from Haryana Statistical Abstract</span>
          </div>
        </label>
      </div>

      <!-- Input Section -->
      <form id="chatForm" class="space-y-4">
        <div class="autocomplete-container">
          <div class="relative">
            <input 
              type="text" 
              id="userInput" 
              placeholder="Ask your question..."
              class="w-full px-5 py-4 pr-16 text-gray-800 text-lg bg-white/90 border-3 border-amber-400 rounded-2xl focus:outline-none focus:ring-4 focus:ring-amber-300 focus:border-amber-500 transition-all shadow-lg"
              autocomplete="off"
              required
            />
            <button 
              type="button"
              id="voiceBtn"
              class="mic-btn absolute right-3 top-1/2 -translate-y-1/2 bg-gradient-to-br from-orange-500 to-amber-500 text-white p-3 rounded-xl border-2 border-orange-400 hover:shadow-xl"
              title="Click to speak"
            >
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
              </svg>
            </button>
          </div>
          
          <!-- Autocomplete Dropdown -->
          <div id="autocompleteDropdown" class="autocomplete-dropdown" style="display: none;"></div>
        </div>

        <button 
          type="submit"
          class="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-bold py-4 px-8 rounded-2xl transition-all transform hover:scale-105 hover:shadow-2xl text-lg shadow-xl border-2 border-blue-500"
        >
          <span class="flex items-center justify-center gap-3">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
            </svg>
            Get Answer
          </span>
        </button>
      </form>

      <!-- Quick Action Buttons -->
      <div class="mt-6 flex flex-wrap gap-3 justify-center">
        <button 
          onclick="openFeedback()"
          class="bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-semibold py-2.5 px-5 rounded-xl transition-all transform hover:scale-105 shadow-lg text-sm border-2 border-green-400 flex items-center gap-2"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"/>
          </svg>
          Feedback
        </button>
      </div>

      <!-- Footer Info -->
      <div class="mt-6 text-center">
        <p class="text-xs text-gray-600">
          Last Updated: <span id="lastModified"></span>
        </p>
        <p class="text-xs text-gray-500 mt-2">
          Powered by AI ‚Ä¢ Government of Haryana
        </p>
      </div>
    </div>
  </div>
</div>

<!-- AI Response Modal -->
<div id="aiModal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="text-2xl font-bold flex items-center gap-3">
        <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
        </svg>
        STATS SAHAYAK Response
      </h2>
      <button class="close-btn" id="closeBtn">&times;</button>
    </div>

    <div class="modal-body">
      <div class="question-box">
        <h3>
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          Your Question
        </h3>
        <p class="question-text" id="modalQuestion"></p>
      </div>

      <div class="answer-box">
        <h3>
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          Answer
        </h3>
        <p class="answer-text" id="modalAnswer">Loading...</p>
      </div>
    </div>

    <div class="modal-footer">
      <button 
        id="ttsToggle"
        class="tts-btn bg-gradient-to-r from-purple-500 to-purple-600 text-white hover:from-purple-600 hover:to-purple-700 shadow-lg"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"/>
        </svg>
        <span id="ttsLabel">Listen</span>
      </button>

      <button 
        id="copyBtn"
        class="tts-btn bg-gradient-to-r from-blue-500 to-blue-600 text-white hover:from-blue-600 hover:to-blue-700 shadow-lg"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
        </svg>
        Copy
      </button>

      <button 
        id="closeModal"
        class="tts-btn bg-gradient-to-r from-gray-500 to-gray-600 text-white hover:from-gray-600 hover:to-gray-700 shadow-lg"
      >
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
        </svg>
        Close
      </button>
    </div>
  </div>
</div>

<!-- Feedback Modal -->
<div id="feedbackModal" class="feedback-modal">
  <div class="feedback-modal-content">
    <div class="feedback-modal-header">
      <h2 class="text-xl font-bold">üìù Share Your Feedback</h2>
      <button class="close-btn" onclick="closeFeedback()" style="width: 36px; height: 36px; font-size: 24px;">&times;</button>
    </div>
    <div class="feedback-modal-body">
      <div id="iframeLoader" class="iframe-loader">
        <div class="spinner"></div>
        <p style="color: #64748b; font-weight: 600;">Loading feedback form...</p>
      </div>
      <iframe id="feedbackIframe" frameborder="0"></iframe>
    </div>
  </div>
</div>

  <script>
// Sample Questions Database for Autocomplete
const SAMPLE_QUESTIONS = {
  statistics: {
    "Statistical Concepts & Definitions": [
      "What is a Price Index?",
      "Explain Consumer Price Index (CPI) in simple terms",
      "What is the difference between mean, median, and mode?",
      "What does fertility rate indicate?",
      "How is population density calculated?",
      "What is Gross Domestic Product (GDP)?",
      "Explain what literacy rate means",
      "What is infant mortality rate and why is it important?",
      "What does per capita income signify?",
      "What is the difference between rural and urban population?"
    ],
    "Statistical Methods & Interpretation": [
      "How do you calculate growth rate?",
      "What is the base year in index numbers?",
      "How to interpret percentage changes in statistics?",
      "What is meant by constant prices vs current prices?",
      "How is workforce participation rate calculated?",
      "What does cropped area mean in agricultural statistics?",
      "How do you measure industrial production?",
      "What is the difference between gross and net area?",
      "How to understand irrigation statistics?",
      "What does enumeration mean in census?"
    ],
    "Economic & Development Indicators": [
      "What are key indicators of economic development?",
      "How is poverty measured statistically?",
      "What role do statistics play in policy making?",
      "How do we measure employment and unemployment?",
      "What is meant by capital formation?",
      "Explain bank deposit and credit statistics",
      "What are cooperative society statistics?",
      "How is agricultural productivity measured?",
      "What do education enrollment ratios indicate?",
      "How is health infrastructure assessed statistically?"
    ],
    "Data Collection & Census": [
      "What is a census and how is it conducted?",
      "What is the difference between census and survey?",
      "How often is population census conducted in India?",
      "What is sample registration system?",
      "How are vital statistics collected?",
      "What is meant by scheduled castes and tribes in census?",
      "How is economic census different from population census?",
      "What data is collected in agricultural census?",
      "How are crime statistics compiled?",
      "What is civil registration system?"
    ]
  },
  data: {
    "Population & Demographics": [
      "What is the total population of Haryana?",
      "Show me district-wise population distribution",
      "What is the literacy rate in Haryana?",
      "Give me rural and urban population breakdown",
      "What is the sex ratio in Haryana districts?",
      "Show scheduled caste population statistics",
      "What is the population density in Ambala district?",
      "How many villages and towns are in Haryana?",
      "What is the working population in Haryana?",
      "Show me age distribution of population"
    ],
    "Agriculture & Irrigation": [
      "What is the total cropped area in Haryana?",
      "Show me foodgrain production statistics",
      "What is the irrigated area in Haryana?",
      "Give me district-wise wheat production data",
      "How many tubewells are there in Haryana?",
      "What is the fertilizer consumption in the state?",
      "Show me area under rice cultivation",
      "What is the livestock population in Haryana?",
      "Give me data on dairy production",
      "What is the area under horticulture crops?"
    ],
    "Industry & Economy": [
      "How many registered factories are in Haryana?",
      "Show me industrial production data",
      "What is the per capita income of Haryana?",
      "Give me banking statistics for Haryana",
      "How many workers are employed in factories?",
      "Show me district-wise industrial units",
      "What is the state domestic product?",
      "Give me cooperative society statistics",
      "What is the power consumption by industries?",
      "Show me small scale industries data"
    ],
    "Infrastructure & Services": [
      "How many schools are there in Haryana?",
      "Give me electricity consumption statistics",
      "How many hospitals and dispensaries exist?",
      "What is the road network length in Haryana?",
      "Show me village electrification data",
      "How many banking offices are in the state?",
      "What is the number of registered vehicles?",
      "Give me data on postal services",
      "What is the housing construction statistics?",
      "Show me telecommunication infrastructure data"
    ],
    "Education & Health": [
      "What is the student enrollment in schools?",
      "How many colleges are in Haryana?",
      "Give me teacher-student ratio statistics",
      "What is the enrollment ratio by districts?",
      "Show me data on technical education institutions",
      "How many hospital beds are available?",
      "What is the infant mortality rate?",
      "Give me family welfare statistics",
      "What is the birth and death rate?",
      "Show me data on medical institutions"
    ],
    "Revenue & Finance": [
      "What is the tax revenue of Haryana government?",
      "Show me expenditure on development schemes",
      "What is the budget allocation by departments?",
      "Give me data on state government employees",
      "What are the small savings collections?",
      "Show me municipal corporation finances",
      "What is the stamp duty collection?",
      "Give me data on public debt",
      "What is the capital expenditure?",
      "Show me GST collection statistics"
    ],
    "Transport & Communication": [
      "How many vehicles are registered in Haryana?",
      "What is the total road length in the state?",
      "Show me district-wise vehicle registration",
      "How many road accidents occurred?",
      "What is the progress of Haryana Roadways?",
      "Give me data on national highways",
      "How many driving licenses were issued?",
      "Show me railway statistics for Haryana",
      "What is the rural connectivity status?",
      "Give me data on motor vehicle taxation"
    ],
    "Employment & Labor": [
      "What is the employment in organized sector?",
      "How many people registered at employment exchanges?",
      "Show me industrial dispute statistics",
      "What are the average wages in different sectors?",
      "Give me data on trade unions",
      "What is the vocational training enrollment?",
      "Show me occupation-wise employment data",
      "What is the worker participation rate?",
      "Give me data on registered establishments",
      "What are the earnings in factories?"
    ]
  }
};

let selectedLanguage = 'english';
let selectedQueryType = 'statistics';

// Initialize radio button states
document.addEventListener('DOMContentLoaded', () => {
  updateRadioSelection();
  
  // Add event listeners to radio buttons
  document.querySelectorAll('input[name="queryType"]').forEach(radio => {
    radio.addEventListener('change', (e) => {
      selectedQueryType = e.target.value;
      updateRadioSelection();
      
      // Clear autocomplete when switching query type
      const autocompleteDropdown = document.getElementById('autocompleteDropdown');
      autocompleteDropdown.style.display = 'none';
      
      // Clear input
      document.getElementById('userInput').value = '';
    });
  });
});

function updateRadioSelection() {
  document.querySelectorAll('.radio-option').forEach(option => {
    const radio = option.querySelector('input[type="radio"]');
    if (radio.checked) {
      option.classList.add('selected');
    } else {
      option.classList.remove('selected');
    }
  });
}

function switchLanguage(lang) {
  selectedLanguage = lang;
  document.getElementById('langEnglish').classList.toggle('active', lang === 'english');
  document.getElementById('langHindi').classList.toggle('active', lang === 'hindi');
}

// AUTOCOMPLETE FUNCTIONALITY
const userInput = document.getElementById('userInput');
const autocompleteDropdown = document.getElementById('autocompleteDropdown');

userInput.addEventListener('input', (e) => {
  const query = e.target.value.trim().toLowerCase();
  
  if (query.length < 2) {
    autocompleteDropdown.style.display = 'none';
    return;
  }
  
  const questions = SAMPLE_QUESTIONS[selectedQueryType];
  let matches = [];
  
  // Search through all categories
  for (const [category, questionList] of Object.entries(questions)) {
    const categoryMatches = questionList.filter(q => 
      q.toLowerCase().includes(query)
    );
    
    if (categoryMatches.length > 0) {
      matches.push({ category, questions: categoryMatches });
    }
  }
  
  if (matches.length === 0) {
    autocompleteDropdown.innerHTML = '<div class="autocomplete-no-results">No matching questions found</div>';
    autocompleteDropdown.style.display = 'block';
    return;
  }
  
  // Build HTML
  let html = '';
  matches.forEach(({ category, questions }) => {
    html += `<div class="autocomplete-category">${category}</div>`;
    questions.forEach(question => {
      const highlighted = question.replace(
        new RegExp(query, 'gi'),
        match => `<mark>${match}</mark>`
      );
      html += `<div class="autocomplete-item" data-question="${question}">${highlighted}</div>`;
    });
  });
  
  autocompleteDropdown.innerHTML = html;
  autocompleteDropdown.style.display = 'block';
  
  // Add click listeners
  document.querySelectorAll('.autocomplete-item').forEach(item => {
    item.addEventListener('click', () => {
      userInput.value = item.dataset.question;
      autocompleteDropdown.style.display = 'none';
    });
  });
});

// Close autocomplete when clicking outside
document.addEventListener('click', (e) => {
  if (!e.target.closest('.autocomplete-container')) {
    autocompleteDropdown.style.display = 'none';
  }
});

// TEXT-TO-SPEECH FUNCTIONALITY
let isSpeaking = false;
let currentUtterance = null;

document.getElementById('ttsToggle').addEventListener('click', () => {
  const answerText = document.getElementById('modalAnswer').textContent;
  
  if (isSpeaking) {
    speechSynthesis.cancel();
    isSpeaking = false;
    document.getElementById('ttsToggle').classList.remove('speaking');
    document.getElementById('ttsLabel').textContent = 'Listen';
  } else {
    currentUtterance = new SpeechSynthesisUtterance(answerText);
    currentUtterance.lang = selectedLanguage === 'hindi' ? 'hi-IN' : 'en-US';
    currentUtterance.rate = 0.9;
    currentUtterance.pitch = 1;
    
    currentUtterance.onstart = () => {
      isSpeaking = true;
      document.getElementById('ttsToggle').classList.add('speaking');
      document.getElementById('ttsLabel').textContent = 'Stop';
    };
    
    currentUtterance.onend = () => {
      isSpeaking = false;
      document.getElementById('ttsToggle').classList.remove('speaking');
      document.getElementById('ttsLabel').textContent = 'Listen';
    };
    
    speechSynthesis.speak(currentUtterance);
  }
});

// FORM SUBMISSION
document.getElementById('chatForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const question = userInput.value.trim();
  if (!question) return;

  const mainContainer = document.querySelector('.container-main');
  if (mainContainer) mainContainer.style.visibility = 'hidden';

  speechSynthesis.cancel();
  isSpeaking = false;
  document.getElementById('ttsToggle').classList.remove('speaking');
  document.getElementById('ttsLabel').textContent = 'Listen';

  document.getElementById('modalQuestion').textContent = question;
  document.getElementById('modalAnswer').textContent = 'Thinking...';
  document.getElementById('aiModal').classList.remove('hidden');
  
  // Hide autocomplete dropdown
  autocompleteDropdown.style.display = 'none';

  const deviceType = /Mobile|Android|iPhone|iPad|iPod/i.test(navigator.userAgent) ? 'Mobile' : 
                     /Tablet|iPad/i.test(navigator.userAgent) ? 'Tablet' : 'Desktop';
  const browserMatch = navigator.userAgent.match(/(Firefox|Chrome|Safari|Edge|Opera|OPR)/i);
  const browser = browserMatch ? browserMatch[0].replace('OPR', 'Opera') : 'Unknown';

  try {
    const webhookUrl = 'https://n8n-workflow-test.duckdns.org/webhook/ask-gitaV2n8n';

    const response = await fetch(webhookUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        question: question,
        language: selectedLanguage,
        queryType: selectedQueryType === 'statistics' ? 'STATISTICAL_CONCEPT_QUERY' : 'STATISTICAL_DATA_QUERY',
        mobNo: 'anonymous',
        deviceType: deviceType,
        browser: browser,
        timestamp: new Date().toLocaleString('en-IN', { timeZone: 'Asia/Kolkata' }),
        userAgent: navigator.userAgent
      })
    });

    const data = await response.json();
    const aiResponse = data.answer || data.error || 'No response received.';
    const disclaimer = "\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n‚ö†Ô∏è Disclaimer: This is an AI-generated response for guidance purposes only. Please verify important information from official sources.";
    const fullResponse = aiResponse + `<span style="line-height: 1.2; display: block; margin-top: 8px;">${disclaimer}</span>`;
    document.getElementById('modalAnswer').innerHTML = fullResponse;
  } catch (error) {
    document.getElementById('modalAnswer').textContent = 'Connection failed: ' + error.message;
  }
});

let recognition;
let isRecording = false;

if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition = new SpeechRecognition();
  recognition.continuous = false;
  recognition.interimResults = false;
  recognition.lang = 'hi-IN';

  recognition.onstart = () => {
    isRecording = true;
    const voiceBtn = document.getElementById('voiceBtn');
    voiceBtn.classList.add('recording');
    voiceBtn.title = 'Recording... Click to stop';
  };

  recognition.onresult = (event) => {
    const transcript = event.results[0][0].transcript;
    userInput.value = transcript;
    // Trigger autocomplete
    userInput.dispatchEvent(new Event('input'));
  };

  recognition.onend = () => {
    isRecording = false;
    const voiceBtn = document.getElementById('voiceBtn');
    voiceBtn.classList.remove('recording');
    voiceBtn.title = 'Click to speak';
  };

  recognition.onerror = (event) => {
    isRecording = false;
    const voiceBtn = document.getElementById('voiceBtn');
    voiceBtn.classList.remove('recording');
    voiceBtn.title = 'Click to speak';
    if (event.error !== 'no-speech') {
      alert('Voice recognition failed. Please try again.');
    }
  };
}

document.getElementById('voiceBtn').addEventListener('click', (e) => {
  e.preventDefault();
  if (recognition) {
    if (isRecording) {
      recognition.stop();
    } else {
      recognition.start();
    }
  } else {
    alert('Voice recognition is not supported in your browser.');
  }
});

document.getElementById('closeBtn').onclick = () => {
  speechSynthesis.cancel();
  document.getElementById('aiModal').classList.add('hidden');
  const mainContainer = document.querySelector('.container-main');
  if (mainContainer) mainContainer.style.visibility = 'visible';
};

document.getElementById('closeModal').onclick = () => {
  speechSynthesis.cancel();
  document.getElementById('aiModal').classList.add('hidden');
  const mainContainer = document.querySelector('.container-main');
  if (mainContainer) mainContainer.style.visibility = 'visible';
};

document.getElementById('copyBtn').onclick = () => {
  const text = document.getElementById('modalAnswer').textContent;
  
  // Modern clipboard API with fallback
  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(text).then(() => {
      const btn = document.getElementById('copyBtn');
      const originalHTML = btn.innerHTML;
      btn.innerHTML = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> Copied!';
      setTimeout(() => { btn.innerHTML = originalHTML; }, 2000);
    }).catch(err => fallbackCopyText(text));
  } else {
    fallbackCopyText(text);
  }
};

// Fallback copy function for older browsers
function fallbackCopyText(text) {
  const textArea = document.createElement('textarea');
  textArea.value = text;
  textArea.style.position = 'fixed';
  textArea.style.left = '-999999px';
  document.body.appendChild(textArea);
  textArea.select();
  try {
    document.execCommand('copy');
    const btn = document.getElementById('copyBtn');
    const originalHTML = btn.innerHTML;
    btn.innerHTML = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> Copied!';
    setTimeout(() => { btn.innerHTML = originalHTML; }, 2000);
  } catch (err) {
    alert('Copy failed. Please copy manually.');
  }
  document.body.removeChild(textArea);
}

window.addEventListener('DOMContentLoaded', () => {
  const lastModifiedDate = new Date(document.lastModified);
  const element = document.getElementById("lastModified");
  if (element) {
    element.textContent = lastModifiedDate.toLocaleDateString('en-US', {
      year: 'numeric', month: 'long', day: 'numeric'
    }) + ' at ' + lastModifiedDate.toLocaleTimeString('en-US', {
      hour: '2-digit', minute: '2-digit'
    });
  }
});

function openFeedback() {
  const feedbackModal = document.getElementById('feedbackModal');
  const feedbackIframe = document.getElementById('feedbackIframe');
  const iframeLoader = document.getElementById('iframeLoader');
  
  feedbackModal.classList.add('show');
  iframeLoader.style.display = 'block';
  
  feedbackIframe.src = 'https://vksinglakkr.github.io/IGM2025/feedback_igm_chatbot.html';
  
  feedbackIframe.onload = function() {
    iframeLoader.style.display = 'none';
  };
  
  feedbackIframe.onerror = function() {
    iframeLoader.innerHTML = '<p style="color: #ef4444; font-weight: 600;">Failed to load feedback form</p>';
  };
}

function closeFeedback() {
  const feedbackModal = document.getElementById('feedbackModal');
  const feedbackIframe = document.getElementById('feedbackIframe');
  const iframeLoader = document.getElementById('iframeLoader');
  
  feedbackModal.classList.remove('show');
  feedbackIframe.src = '';
  
  iframeLoader.style.display = 'none';
  iframeLoader.innerHTML = '<div class="spinner"></div><p style="color: #64748b; font-weight: 600;">Loading feedback form...</p>';
}

document.getElementById('feedbackModal').addEventListener('click', function(e) {
  if (e.target === this) {
    closeFeedback();
  }
});
  </script>
</body>
</html>
